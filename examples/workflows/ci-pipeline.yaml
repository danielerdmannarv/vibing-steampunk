# Example: CI/CD pipeline workflow
# Usage: vsp workflow run examples/workflows/ci-pipeline.yaml

name: ci-pipeline
description: Continuous Integration pipeline - syntax check and test

variables:
  PACKAGE: "$ZRAY*"

steps:
  - name: discover
    action: search
    parameters:
      query: "${PACKAGE}"
      types: [CLAS]
      maxResults: 200
    saveAs: classes

  - name: log-discovery
    action: print
    parameters:
      message: "Discovered classes for testing"

  - name: syntax-validation
    action: syntax_check
    parameters:
      objects: classes
    saveAs: syntaxResults

  - name: fail-on-syntax-errors
    action: fail_if
    parameters:
      condition: "syntax_errors:syntaxResults"
      message: "Build failed: syntax errors detected"

  - name: unit-tests
    action: test
    parameters:
      objects: classes
    saveAs: testResults

  - name: fail-on-test-failures
    action: fail_if
    parameters:
      condition: "tests_failed:testResults"
      message: "Build failed: unit tests failed"

  - name: success-message
    action: print
    parameters:
      message: "CI pipeline completed successfully!"
