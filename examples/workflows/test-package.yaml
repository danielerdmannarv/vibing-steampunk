# Example: Test all classes in a package
# Usage: vsp workflow run examples/workflows/test-package.yaml --var PACKAGE=\$TMP

name: test-package
description: Run unit tests for all classes in a package

variables:
  PACKAGE: "$TMP"

steps:
  - name: discover-classes
    action: search
    parameters:
      query: "${PACKAGE}/*"
      types: [CLAS, PROG]
      maxResults: 100
    saveAs: objects

  - name: syntax-check
    action: syntax_check
    parameters:
      objects: objects
    saveAs: syntaxResults
    onFailure: continue

  - name: check-syntax-errors
    action: fail_if
    parameters:
      condition: "syntax_errors:syntaxResults"
      message: "Syntax errors found - fix before running tests"

  - name: run-tests
    action: test
    parameters:
      objects: objects
      dangerous: false
      long: false
    saveAs: testResults

  - name: check-test-results
    action: fail_if
    parameters:
      condition: "tests_failed:testResults"
      message: "Some tests failed"
